<<<BEGIN>>>
# 07_input_to_rce_入力→実行の導線.md

（先頭要約：このプレイブックの位置づけ）
- 目的：入力検証の欠落からRCE（Remote Code Execution）までの導線を、最小差分で明確化する
- 主役：ツールやペイロードではなく、**成立条件（境界）と観測点（差分）**
- 対象：Webアプリの入力処理（テンプレート、デシリアライズ、コマンド実行、ファイル操作等）

## 目的（このプレイブックで到達する状態）
- 入力処理の「どこで境界が崩れるか」を、観測根拠つきで説明できる
- RCE成立の「最小条件」を特定し、影響範囲（権限・環境・到達性）を確定できる
- 検証の再現性を確保し、証跡（リクエスト/レスポンス/ログ）を残せる

## 前提（対象・範囲・想定）
- 対象：許可された検証範囲のWebアプリ（本番相当の検証環境を推奨）
- 想定：
  - 入力→実行の境界は複数ある（テンプレート、デシリアライズ、コマンド、ファイル、DB等）
  - 成立条件は「入力の形式」「実行コンテキスト」「権限」「環境」で変わる
- Labs連動：
  - `04_labs/03_targets/04_intentionally_vuln_apps_導入（DVWA_JuiceShop）.md`
  - `04_labs/03_targets/08_deser_targets_検証環境（Java_PHP）.md`

## 入力（最初に揃えるもの：最小セット）
- 対象アプリの入口（URL、機能、入力フォーム/API）
- 観測結果（HTTPリクエスト/レスポンス、エラーメッセージ、挙動の差分）
- 技術スタックの手掛かり（レスポンスヘッダ、エラーページ、JS等）

## 観測の進め方（順序固定：入力→境界→実行→影響）

### 1) 入力の観測（何を受け付けているか）
- 観測するもの（例）
  - 入力形式（テキスト、JSON、XML、バイナリ、ファイル等）
  - 処理の挙動（エラー、リダイレクト、レスポンスの差分）
  - エラーメッセージ（スタックトレース、技術スタックの手掛かり）
- ここで確定したい状態
  - 「どの形式の入力を、どこで処理しているか」を説明できる

### 2) 境界の特定（どこで実行に到達するか）
- 観測するもの（例）
  - テンプレート処理（SSTI：Server-Side Template Injection）
  - デシリアライズ処理（Java/PHP/Python等のオブジェクト復元）
  - コマンド実行（OSコマンド、シェル、スクリプト）
  - ファイル操作（読み書き、アップロード、インクルード）
- ここで確定したい状態
  - 「入力がどの境界（処理段階）で実行に到達するか」を説明できる

### 3) 成立条件の特定（最小差分で切る）
- 観測するもの（例）
  - 入力の形式差（通常入力 vs 特殊文字/構文）
  - 処理コンテキスト（権限、環境変数、ファイルシステム）
  - 実行結果の差分（成功/失敗、出力、エラー）
- ここで確定したい状態
  - 「この条件なら成立、違うなら不成立」を最小差分で説明できる

### 4) 影響範囲の確定（権限・環境・到達性）
- 観測するもの（例）
  - 実行権限（ユーザー、プロセス、コンテナ）
  - 環境（OS、ネットワーク、ファイルシステム）
  - 到達性（外部からの接続、リバースシェル、データ持ち出し）
- ここで確定したい状態
  - 「成立した場合の影響範囲」を説明できる

## 判断（A/B分岐：次の一手を決める）

### 分岐A：テンプレート処理（SSTI）の可能性
- 次の一手
  - 技術ユニット参照：`01_topics/02_web/05_input_01_入力→実行境界（テンプレート注入_SSTI）.md`
  - 検証環境：`04_labs/03_targets/04_intentionally_vuln_apps_導入（DVWA_JuiceShop）.md`
- 観測点
  - テンプレート構文（`{{ }}`, `${ }`, `<% %>`等）の挙動
  - 実行結果の出力（コマンド実行、ファイル読み取り等）

### 分岐B：デシリアライズ処理の可能性
- 次の一手
  - 技術ユニット参照：`01_topics/02_web/05_input_02_入力→実行境界（デシリアライズ_型混乱_ガジェット前提）.md`
  - 検証環境：`04_labs/03_targets/08_deser_targets_検証環境（Java_PHP）.md`
- 観測点
  - シリアライズ形式（Java/PHP/Python等）の特定
  - ガジェットチェーン（利用可能なクラス/関数）の探索

### 分岐C：コマンド実行の可能性
- 次の一手
  - 技術ユニット参照：`01_topics/02_web/05_input_00_入力→実行境界（テンプレ デシリアライズ等）.md`
- 観測点
  - OSコマンド、シェル、スクリプトの実行
  - 権限と環境（ユーザー、プロセス、コンテナ）

### 分岐D：ファイル操作の可能性
- 次の一手
  - 技術ユニット参照：`01_topics/02_web/05_input_00_入力→実行境界（テンプレ デシリアライズ等）.md`
- 観測点
  - ファイル読み書き、アップロード、インクルード
  - パストラバーサル、ファイルシステム境界

## 証跡（最小セット：再現性のため）
- 入力（リクエスト）：形式、内容、ヘッダ
- 処理（観測）：エラーメッセージ、挙動の差分、ログ
- 実行（結果）：出力、権限、環境、到達性
- 影響（範囲）：権限、環境、到達性、データ持ち出し

## ガイドライン対応（ASVS / WSTG / PTES / MITRE ATT&CK：毎回）
- ASVS：
  - 入力検証（V5）、セキュアコーディング（V6）、データ保護（V7）の要求を、実務の判断（境界・成立条件・影響）に落とす
- WSTG：
  - テスト観点（Input Validation、Injection等）を「観測→意味→次の一手」に変換
- PTES：
  - Vulnerability Analysis：成立条件の特定
  - Exploitation：最小差分での再現
- MITRE ATT&CK：
  - 戦術：Execution（コマンド実行）、Persistence（永続化）、Exfiltration（データ持ち出し）

## 関連リンク（リポジトリ内：必要最小限）
- 技術ユニット（Input領域）
  - `01_topics/02_web/05_input_00_入力→実行境界（テンプレ デシリアライズ等）.md`
  - `01_topics/02_web/05_input_01_入力→実行境界（テンプレート注入_SSTI）.md`
  - `01_topics/02_web/05_input_02_入力→実行境界（デシリアライズ_型混乱_ガジェット前提）.md`
- 検証環境（Labs）
  - `04_labs/03_targets/04_intentionally_vuln_apps_導入（DVWA_JuiceShop）.md`
  - `04_labs/03_targets/08_deser_targets_検証環境（Java_PHP）.md`

<<<END>>>

